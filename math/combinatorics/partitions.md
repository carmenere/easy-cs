# Table of contents
- [Table of contents](#table-of-contents)
- [Раскладки](#раскладки)
- [Разбиения](#разбиения)
  - [Упорядоченные разбиения](#упорядоченные-разбиения)
  - [Неупорядоченные разбиения](#неупорядоченные-разбиения)
  - [Непересекающиеся разбиения](#непересекающиеся-разбиения)
- [Числа](#числа)
  - [Числа Стирлинга 2-рода](#числа-стирлинга-2-рода)
  - [Числа Белла](#числа-белла)
  - [Числа Каталана](#числа-каталана)

<br>

# Раскладки
Допустим, есть **мульти**множество $`X = \{1,1,2,2,\dots\}`$ мощности **n**, т.е. $`|X| = n`$. В **мультимножестве** допускаются **повторения** элементов.<br>
**Раскладка мультимножества** - такое разложение всех его элементов на **k** подмножеств, когда допускаются **пустые** подмножества, а элементы в подмножествах могут **повторяться**, т.е. **пересечения** подмножеств могут быть **не** пустыми.<br>

В таком случае достаточно легко подсчитать количество всех возможных раскладок: если за **элемент** множества $`X`$ принять очередной **шаг**, на котором мы делаем **выбор**, а за **вариант** выбора - конкретное **подмножество**, в которое этот элемент нужно отправить, то получается, что у нас есть **n** выборов и для каждого такого выбора есть **k вариантов**.<br>

Т.о. получаем общее количство раскладок: $`k^{n}`$

<br>

# Разбиения
Допустим, есть множество $`X = \{1,2,\dots,n\}`$ мощности $`n`$, т.е. $`|X| = n`$.<br>
**Разбиение множества** $`X`$ на $`k`$ подмножеств - такое разложение всех его элементов на $`k`$ **непустых попарно непересекающихся** подмножеств, что **объединение** всех подмножеств снова даёт **исходное множество** $`X`$.<br>
(A **partition of a set** is a grouping of its elements into **non-empty subsets**, in such a way that **every** element is **included** in **exactly one** subset, i.e., the subsets are **nonempty mutually disjoint sets**, **union** of **all** such **subsets** gives us **original set**.)<br>

**Размеры** подмножеств в каждом конкретном разибении на $`k`$ подмножеств - **фиксированны**.<br>

<br>

Варианты разбиений на $`k`$ подмножеств:
- **упорядоченное разбиение**: когда **порядок** подмножеств **важен**;
- **неупорядоченные разбиение**: когда **порядок** подмножеств **не** важен;
- **непересекающиеся разбиения** (**noncrossing partitions**): такое разбиение, в котором элементы из **разных** разбиений **не** пересекаются;

<br>

## Упорядоченные разбиения
Рассмотрим следующее **разбиение** множества $`X`$ на $`s`$ подмножеств:<br>
||1|2|...|s-1|s|
|:-|:------|:--------|:--------|:---------|:-|
||$`x_{1}`$|$`x_{2}`$|...|$`x_{s-1}`$|$`x_{s}`$|
||$`n_{1}`$|$`n_{2}`$|...|$`n_{s-1}`$|$`n_{s}`$|

<br>

Сумма всех $`n_{i}`$ равна $`n`$: $`n_{1} + n_{2} + ... + n_{s} = n`$.<br>

Тогда, **упорядоченное разбиение** множества $`X`$ на $`s`$ подмножеств - это **кортеж** длины $`s`$, элементами которого являются полученные в ходе разбиения подмножества:<br>
$`(x_{1}, \space, x_{2}, \space \dotsc, \space x_{s})`$.

**Количество всех упорядоченных разбиений** множества $`X`$ на $`s`$ подмножеств - это **количество всех** возможных **таких кортежей**.<br>

<br>

Получается, что:
- выбрать $`n_{1}`$ элементов для $`x_{1}`$, другими словами выбрать элемент $`x_{1}`$ **кортежа**, мы можем $`C^{n}_{n_{1}}`$ способами;
- далее выбрать $`n_{2}`$ элементов для $`x_{2}`$ мы уже можем $`C^{n-n_{1}}_{n_{2}}`$ способами;
- ...
- далее выбрать $`n_{s}`$ элементов для $`x_{s}`$ мы уже можем $`C^{n-n_{1}-n_{2}-...-n_{s-1}}_{n_{s}}`$ способами;

<br>

Тогда согласно правилу умножений, количество **кортежей**, а значит и **количество всех упорядоченных разбиений** будет:
$`C^{n}_{n_{1}} \cdot C^{n-n_{1}}_{n_{2}} \cdot \dotsc \cdot C^{n-n_{1}-n_{2}-...-n_{s-1}}_{n_{s}}`$.<br>

<br>

Если все перемножить и сократить, то получим:
$`C^{n}_{n_{1}} \cdot C^{n-n_{1}}_{n_{2}} \cdot \dotsc \cdot C^{n-n_{1}-n_{2}-...-n_{s-1}}_{n_{s}} = \frac{n!}{n_{1}!\cdot n_{2}!\cdot \dotsc \cdot n_{s}!}`$.<br>

<br>

Пример, всего имеется **6** различных **упорядоченных** разбиений **4-х** элементного множества на **2** подмножества **фиксированного** *размера* **2**:
![](/img/partitions_1.png)

<br>

## Неупорядоченные разбиения
При **не**упорядоченном разбиении, если в разбиении имеются **2** подмножества $`x_{i}`$ и $`x_{j}`$ и их **мощности равны** $`|x_{i}| = |x_{j}|`$, то, если их **поменять местами** - то мы получим **то же самое разбиение**.<br>

Рассмотрим **некоторое** разбиение $`\{\{1,2\},\space \{3,4\}\}`$ **4-х** элементного множества на **2** подмножества **фиксированного** *размера* **2**. Если в нем **поменять местами 2** подмножества - мы получим **другое** разбиение $`\{\{3,4\},\space \{1,2\}\}`$:
![](/img/partitions_2.png)

<br>

**Но** с точки зрения **неупорядоченного разбиения** - $`\{\{1,2\},\space \{3,4\}\}`$ и $`\{\{3,4\},\space \{1,2\}\}`$ - **два одинаковых разбиения**.<br>

А значит имеется **6/2** различных **неупорядоченных** разбиений **4-х** элементного множества на **2** подмножества размером **2**:
![](/img/partitions_3.png)

<br>

Рассмотрим следующее **разбиение** множества $`X`$ на $`7`$ подмножеств:<br>
|Подмножество|Мощность|
|:---|:-----------|
|$`x_{1}`$|$`n_{1}=11`$|
|$`x_{2}`$|$`n_{2}=9`$|
|$`x_{3}`$|$`n_{3}=11`$|
|$`x_{4}`$|$`n_{4}=9`$|
|$`x_{4}`$|$`n_{4}=9`$|
|$`x_{5}`$|$`n_{5}=5`$|
|$`x_{6}`$|$`n_{6}=5`$|
|$`x_{7}`$|$`n_{7}=7`$|

<br>

Назначим каждой мощности **индекс** $`i`$ так, что все **одинаковые** мощности получат **одинаковый** индекс $`i`$.<br>
Тогда число $`m_{i}`$ будет обозначать *сколько раз* **мощность** с **индексом** $`i`$ **встретилась** в разбиении: 
- назначим мощности **11** индекс **1**, тогда $`m_{1}=2`$;
- назначим мощности **9** индекс **2**, тогда $`m_{2}=3`$;
- назначим мощности **5** индекс **3**, тогда $`m_{3}=2`$;
- назначим мощности **7** индекс **4**, тогда $`m_{4}=1`$;

<br>

При **не**упорядоченном разбиении подмножества с **одинаковой** мощностью **могут меняться местами** и **все** таким образом полученные **разибения** будут считаться **одинаковыми**.<br>
Т.к. $`m_{i}`$ обозначает *сколько раз* подмножество, **мощности** которого назначен **индекс** $`i`$, **встретилось** в разбиении, то существует $`m_{i}!`$ способов поменять местами подмножества мощность которых получила **индекс** $`i`$. <br>

<br>

Получается, что если имеется **k** групп множеств с **одинаковыми** мощностями, то количество **не**упорядоченных разложений будет в $`m_{1}! \cdot m_{2}! \cdot \dotsc \cdot m_{k}!`$ меньше количества **упорядоченных** разбиений для этих же множеств.<br>

$`\frac{C^{n}_{n_{1}} \cdot C^{n-n_{1}}_{n_{2}} \cdot \dotsc \cdot C^{n-n_{1}-n_{2}-...-n_{s-1}}_{n_{s}}}{m_{1}! \cdot m_{2}! \cdot \dotsc \cdot m_{k}!} = \frac{n!}{n_{1}!\cdot n_{2}!\cdot \dotsc \cdot n_{s}! \cdot m_{1}! \cdot m_{2}! \cdot \dotsc \cdot m_{k}!}`$.<br>

<br>

## Непересекающиеся разбиения
**Непересекающееся разбиение** множества $`X = \{1,2,\dots,n\}`$ - такое разбиение на **непересекающиеся подмножества**, что если существует элементы из $`X`$ такие, что $`a \lt b \lt c \lt d`$, то $`a`$ и $`c`$ **не** могут оказаться в подмножестве **отличном** от того, где оказались $`b`$ и $`d`$. Другими словами, если $`b`$ и $`d`$ попали в **некоторое подмножество** при разбиении, то $`a`$ и $`c`$ должны попасть в **него же** и **не** могут быть в другом.<br>

**Непересекаемость** подмножеств можно **визуализировать** таким образом: если все элементы множества $`X`$ нанести на окружность и **соединить линиями** **все** элементы, попавшие в некоторое **подмножество** при разбиении, то **не** должно быть **ни одного пересечения**.<br>

<br>

# Числа
## Числа Стирлинга 2-рода
**Числа Стирлинга 2-рода** $`S(n, k)`$ - количество всех **неу**порядоченных разбиений **n**-элементного множества на **k** непустых подмножеств.<br>

В общем случае существует **несколько** независимых разбиений на **k** непустых подмножеств и для каждого из них нужно посчитать количество **неу**порядоченных разбиений по формуле и сложить полученные значения.<br>

Например, множество из **4** элементов можно разбить на **2** подмножества **двумя** разными способами:
- **2** подмножества, **каждое** из которых **размером 2**:
- **2** подмножества, **одно** из которых имеет **размер 1**, а **другое** - **размер 3**;

<br>

**Например**, $`S(4, 2) = 7`$, т.к. существует **7** способов разбиения множества из **4** элементов на **2** подмножества:
- **3** способа разбить множества из **4** элементов на **2** подмножества, каждое из которых **размером 2**:
- **4** способа разбить множества из **4** элементов на **2** подмножества, одно из которых имеет **размер 1**, а другое - **размер 3**;

**Визуализация**:<br>
![](/img/partitions_4.png)

**Следовательно**: $`S(4, 2) = \frac{4!}{2!\cdot 2! \cdot 2!} + \frac{4!}{1!\cdot 3! \cdot 1! \cdot 1!} = 7`$.

<br>

## Числа Белла
**Число Белла** $`B_{n}`$ - количество **всех не**упорядоченных разбиений **n**-элементного множества для всех **k** от **0** до **n** включительно.<br>
**Число Белла** можно вычислить как **сумму** *чисел Стирлинга второго рода* $`S(n, k)`$ для **всех k** от **0** до **n** включительно.<br>

Рассмотрим множество из **3**-х элементов $`\{a,b,c\}`$.
Найдем числа $`S(3, k)`$ для всех **k**:
- существует всего **1** разбиение на **3** (**k=3**) подмножества размера **1**:
  - $`\{\{a\},\{b\},\{c\}\}`$;
  - **следовательно**: $`S(3, 1) = \frac{3!}{1!\cdot 1! \cdot 1! \cdot 3!} = 1`$;
- существует **3** разбиение на **2** (**k=2**) подмножества, **одно** из которых имеет **размер 1**, а **другое** - **размер 2**:
  - $`\{\{a\},\{b,c\}\}`$;
  - $`\{\{b\},\{a,c\}\}`$;
  - $`\{\{c\},\{a,b\}\}`$;
  - **следовательно**: $`S(3, 2) = \frac{3!}{2!\cdot 3!} = 3`$;
- существует **1** разбиение на **1** (**k=1**) подмножество размера **3**:
  - $`\{\{a,b,c\}\}`$;
  - **следовательно**: $`S(3, 3) = \frac{3!}{3!} = 1`$;

**Следовательно**, $`B_{3} = S(3, 1) + S(3, 2) + (3, 3) = 1 + 3 + 1 = 5`$.<br>

<br>

## Числа Каталана
**Число Каталана** $`C_{n}`$ - количество **всех непересекающихся** разбиений **n**-элементного множества $`{1,\space \dotsc, \space n}`$.<br>

<br>

**n-е число Каталана**: $`C_{n} = \frac{(2 \cdot n)!}{(n+1)! \cdot n!}`$.

<br>

**n-е число Каталана** $C_{n}$ можно определить несколькими эквивалентными способами:
- количество всех **непересекающихся** разбиений **2n**-элементного множества $`{1,\space \dotsc, \space 2n}`$ на подмножества **размером 2**;
- количество всех возможных разбиений **выпуклого (n+2)**-угольника на *треугольники* **непересекающимися** диагоналями;
- количество всех возможных способов соединения **2n** точек на окружности **n непересекающимися** хордами;
- количество всех **правильных** скобочных последовательностей длины **2n**, например, для **n = 3** существует $C_{3} = 5$ таких последовательностей:
  - `((()))`;
  - `()(())`;
  - `()()()`;
  - `(())()`;
  - `(()())`;

<br>

**Пример**. Дано множество $`X = \{1,2,3\}`$. Все его **непересекающиеся** разбиения:
- $`\{\{1,2,3\}\}`$;
- $`\{\{1,2\}, \space \{3\}\}`$;
- $`\{\{1,3\}, \space \{2\}\}`$;
- $`\{\{1\}, \space \{2,3\}\}`$;
- $`\{\{1\}, \space \{2\}, \space \{3\}\}`$;

<br>

Мы видим, что $`C_{3} = \frac{(2\cdot 3)!}{(3+1)! \cdot 3!} = \frac{1 \cdot \cancel{2} \cdot \cancel{3} \cdot \cancel{4} \cdot 5 \cdot \cancel{6}}{1 \cdot \cancel{2} \cdot \cancel{3} \cdot \cancel{4} \cdot 1 \cdot \cancel{2} \cdot \cancel{3}} = 5`$.<br>

<br>

**Визуализация**:
![](/img/partitions_catalan.png)
